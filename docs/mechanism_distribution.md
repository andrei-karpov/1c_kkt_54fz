# Механизм распределения #

>**Внимание**: **Механизм распределения** будет работать, если обработка сможет определить документ для печати, для этого этот документ должен быть ей передан в явном виде. Если же нет, то при печати будет выведено окно с предложением указать этот документ вручную. Проверьте сделана ли у вас доработка из видео.

В обработке множество параметров, и для большинства можно задать условие их применения. Механизм использования этих настроек одинаков для каждого, поэтому общие моменты будут описаны здесь, далее будут приведены ссылки уже на этот
раздел.

Описание параметров размещено с учетом приоритета их применения: от наименее приоритетного к наиболее. Если в вашей конфигурации не будет отображаться один из описанных условий, то у вас просто нет таких метаданных. Далее под словом
«параметр» будет иметься ввиду именно их значение, например «Признак предмета расчета», или «Признак способа расчета» и т.д.

## Условия распределения ##

### Типы документов ###

![настройка типов документов](media/167338a55e92a0db5f373064d194ae5d.png)

Здесь можно выбрать тип документа, где применять параметр. Например, мы хотим, чтобы для документа «Корректировка долга», всегда была ставка НДС 20%, здесь это можно указать. Данное условие применяется перед формированием таблицы чека, является наименее приоритетным.

>**Обратите внимание**, также в настройке можно указать «**Все документы**» - «*ALL*», в таком случае условие будет накладывать сразу на все чеки, которые сформирует обработка.

### Организации ###

![Организации](media/494dfdd3cf77693cce853d10357521a3.png)

Можно выбрать для какой организации применять параметр. Например, мы хотим, чтобы для организации «Стройснаб» отсутствовал НДС в чеках. Применяется, если для документа удается определить организацию.

### Контрагенты ###

![Контрагенты](media/550bb11b64114227fed30482fc90afc3.png)

Можно выбрать для какого контрагента применять параметр. Например, мы хотим, чтобы для контрагента «Белявский» и всех контрагентов в папке «Магазины» в чеке не выходил их инн и наименования. Применяется, если для документа удается
определить контрагента. Возможно указать сразу каталог.

### Подразделения ###

![Подразделения](media/66d0eb9dc4fc6bb42539e87a8848be4c.png)

Можно выбрать для какого подразделения применять параметр. Например, мы хотим, чтобы для подразделения «Отдел оптовой техники» в чек сразу передавался признак способа расчета «Передача с полной оплатой». Применяется, если для документа удается определить подразделение.

### Склады ###

![Склады](media/3fbb5797de7f8ffd808959658cafe9f5.png)

Можно выбрать для какого склада применять параметр. Например, мы хотим, чтобы для склада «Магазин №2» в продажу идет только «Табачная продукция». Применяется, если для документа удается определить склад.

### Виды маркировки ###

![Виды маркировки](media/markirovka_vid.png)

Можно выбрать для какого вида маркировки выбирать распределение. Например, мы хотим, чтобы табачная продукция фиксировалась как "Объемно-сортовой учет"

### Виды номенклатуры ###

![Виды номенклатуры](media/a6637a8dfb1bcb5aeadc33a1b70ee626.png)

Можно выбрать для какого вида номенклатуры применять параметр. Например, мы хотим, чтобы для вида номенклатуры «Услуга» признак предмета расчета был «Услуга». Применяется, если для номенклатуры документа, где можно определить вид номенклатуры.

### Номенклатурные группы ###

![Номенклатурные группы](media/d7f879a4c8e69dc064ba3c3ca8ef7003.png)

Можно выбрать для какой номенклатурной группы применять параметр. Например, мы хотим, чтобы вся номенклатура номенклатурной группы пробивалась как маркировочная продукция «Обувные товары». Применяется, если для номенклатуры
документа, где можно определить номенклатурную группу.

### Характеристика ###

![Характеристика](media/e37933de16fe501fdd1c4a8cf5769291.png)

Можно выбрать для какой характеристики номенклатуры применять параметр. Например, мы хотим, чтобы определенные маски проходили как средства индивидуальной защиты, и по ним передавалась информация в ОФД.

### Номенклатура ###

![Номенклатура](media/ce4ddb5548f88fbe461d4341e11fd06e.png)

Можно выбрать для какой номенклатуры применять параметр. Например, мы хотим, чтобы вся номенклатура в папках «Сигареты» выходил в чеке номер гтд и код страны, а для других нет. Применяется для номенклатуры документа печати.
Поддерживает указания папок номенклатуры.

### Типы справочников ###

![Типы справочников](media/d726443442f83d0fb8de8b05c086ad6e.png)

Можно выбрать для какой типа справочника, который имеет печатаемая фискальная строка применять параметр. В чек может выходить не только номенклатуры, но и другие поля документа. Поэтому, если в чек выходят справочник «Проекты», то
можно, например, указать, что для них не выходить ИНН покупателя и его наименование.

### Произвольный код для документа ###

![Произвольный код](media/0b02eca370399e0670bfd847222dd1d5.png)

Помимо установки параметров по отбору, можно и прописать произвольный код распределения, который будет применяться, возможно указать как для всего документа, так и для конкретной позиции чека. Чтобы понять, какое именно значение ожидает параметр «ПризнакРаспределения» в форме есть команда «**Вставить возможный вариант результата**»

![Указать произвольный код](media/2562b603744e1507118abd3bbccf75be.png)

**Доступные параметры**:

**пИмяДокумента** – Имя метаданных документа, из которого происходит печать чеков.

**пДок** – Ссылка на документ, из которого происходит печать, доступны все его реквизиты.

**пИмяПоля** – это наименование поле параметра распределения, например, «ПризнакСпособаРасчета», или «НомерСекции», в основном нужно использовать при распределении СНО, когда может быть несколько полей распределения.

И др. команды конфигурации

Для того, чтобы понять, какое значнеие необходимо установить в поле **"ПризнакРаспределения"** - можно воспользоваться командой контекстного меню "Вставить" - **"Возможный вариант распределения"**

### Произвольный код для позиции чека ###

![Произвольный код для позиции](media/f16eabe6f09ba5b06e1f240ad28859b9.png)

**Доступные параметры**:

**мОбщиеПараметры.ДокументОснование** – Ссылка на документ, из которого происходит печать, доступны все его реквизиты.

**пИмяПоля** – это наименование поле параметра распределения, например, **«ПризнакСпособаРасчета»**, или **«НомерСекции»**, в основном нужно использовать при распределении СНО, когда может быть несколько полей

**СтрокаПозицииЧека.\*** - это данные фискальной строки чека, для которой будет происходить заполнение шаблона.

## Распределение по системам налогообложения ##

![Распределение по СНО](media/16bb9b630063e8d815a6621495d53e36.png)

Данную настройку можно использовать для использования нескольких систем налогообложения в чеке. См. [**«Механизм распределения»**](#механизм-распределения)

При печати на разные системы налогообложения формируется несколько чеков, поэтому при ошибке печати в обработке предусмотрена возможность печать только выбранных чеков. См. [«**Не Печатать**»](form_check_and_check_correction.md#форма-проверки-печати-рабочее-место-кассира).

## Распределение по номерам секций ##

![Распределение по номерам секций](media/230d383e02a44a6cf7072f3ed31dfdad.png)

Данную настройку можно использовать для разделения позиций чека на секции налогообложения. См. [«Механизм распределения»](#механизм-распределения)

## Распределение по договорам Агента ##

В обработке есть возможно указать «Договор Агента», а также «Признак Агента» для передачи в ОФД.

![Распределение по договорам Агента](media/5ef0a3d32eaed35df03ec3a49bc4cd88.png)

В форме договора агента можно указать «Признак агента», «Операция платежного агента», «Телефон платежного агента», «Телефон оператора по приему платежей», «Наименование оператора перевода», «Телефон оператора перевода», «Адрес
оператора перевода», «ИНН Оператора перевода».

![Распределение по договорам Агента](media/f3b2e4b2f9d9c3e8324de02b3164e306.png)

После этого необходимо задать условие при каких параметрах проставлять данный договор. Для настройки условий использования см. [Механизм распределения](#механизм-распределения)

## Настройка признаков предмета расчета ##

![Настройка признаков предмета расчета](media/479f00ca13284f294830572fc33e41ac.png)

Чтобы задать в обработке условие заполнения «Признака предмета расчета», благодаря этому можно явно прописать, когда использовать Залог, выигрыш лотереи, акцизный товар. Для настройки распределения признаков предмета расчета по чекам
см. [Механизм распределения](#механизм-распределения)

## Настройка признаков способа расчета ##

![Настройка признаков способа расчета](media/c10c3e93d4d0cff47b36dfb7408625f7.png)

В обработке задать условия указания «Признака способа расчета», благодаря этому можно явно прописать, где использовать Аванс, или передачу с частичной оплатой. Для настройки распределения признаков способа расчета по чекам см. [Механизм распределения](#механизм-распределения)

## Настройка поставщика агента ##

В обработке есть возможно указать «Поставщика Агента»

![Настройка поставщика агента](media/9dd2854f5b4d3a6e6d4f22b2bed6cecc.png)

В форме поставщика можно указать «**Поставщика услуг**», «**Инн поставщика**», «**Телефон поставщика**».

![Параметры агента](media/4960caf696b11d46d4f7e057b16a4d28.png)

Флажок в форме распределения «В шапке» и «в позициях», указывает где именно в фискальном чеке прописывать поставщика, если флажок стоит «в позициях», то поставщик будет передан в ОФД внутри тега номенклатуры.

Чтобы задать в обработке условие заполнения «Поставщика агента». см. [Механизм распределения](#механизм-распределения)

## Настройка печати реквизитов ГТД и Страна ##

![Настройка печати реквизитов ГТД и Страна](media/edf2d29e7d91389251aa6f3264b93e28.png)

По умолчанию обработка пытается определить данные номенклатуре о номере таможенной декларации, и коде страны происхождения и передает их в ОФД, чтобы не передавать эти поля, можно задать определенные условия. См. [Механизм распределения](#механизм-распределения). Флажок «Печатать» должен быть снят, чтобы данные о гтд не передавались.

## Настройка печати получателя и его ИНН ##

![Настройка печати получателя и его ИНН](media/a1713c9def569c4b41f6ab8ff7d9af5d.png)

По умолчанию обработка пытается определить данные о контрагенте и его ИНН и передает их в ОФД, чтобы не передавать эти поля, можно задать определенные условия. См. [Механизм распределения](#механизм-распределения). Флажок **«Печатать»**
должен быть снят, чтобы данные о покупателе не передавались.

## Настройка ограничения времени продажи ##

![Настройка ограничения времени продаж](media/77da70edc4b67687b401032a88194ac1.png)

В параметрах обработки можно также указать время, когда можно продавать товар, например, это актуально для Алкоголя. Настройка условий распределения См. [Механизм распределения](#механизм-распределения).

## Настройка ставки НДС по умолчанию ##

![Настройка ставки НДС по умолчанию](media/9d5abda851c063f858ce556e32676853.png)

Если в организации применяется одна ставка НДС, то можно ее сразу прописать в параметрах, тогда именно она будет использована при заполнении. По заполнению параметров см. [«Механизм распределения»](#механизм-распределения)

## Подмена номенклатуры ##

![Задать условие подмены номенклатуры](media/21b7b6a2698a89b5db799c71ad7b8678.png)

Можно указать настройки замены схожих позиций номенклатура на собственное наименование. По заполнению параметров см. [«Механизм распределения»](#механизм-распределения)
