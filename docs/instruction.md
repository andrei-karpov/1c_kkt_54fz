<link rel="stylesheet" href="/assets/stylesheets/extra_show_nav.css">

# Дополнительная функциональность #

>**Обратите внимание**, что основной функционал обработки представлен также в видео:

[Первое видео](https://www.youtube.com/watch?v=uVJSKu6wHXE) (_устарело_))

[Второе видео](https://www.youtube.com/watch?v=T3Qr9CJBb48) (_устарело_)

[Третье видео](https://www.youtube.com/watch?v=ZOXDoqp12sk) (_устарело_))


## Поддержка НДС 5% и 7% ##

В связи с изменениями законодательства, обработка поддерживает использование ставок НДС 5% и 7% с версии 3.90. Однако это еще не значит, что ваша 1С будет формировать чеки с этой ставкой, для полноценного использования данного режима, нужно сделать следующее:

1. [Обновиться](connecting.md#как-обновить-ранее-приобретенную-программу) до версии обработки **3.90** или выше.
   
2. Использовать компоненты на оборудование, что работают на [ревизии](connecting.md#что-такое-ревизия-драйвера) 4004 или выше. На текущй момент данную ревизию поддерживают компонента АТОЛ и Эмулятор торгового оборудования.

   
3. Установить актуальные драйвера, что поддреживают данную ставку, и при необходимости установить прошивку. 
   - Например, если у вас драйвера АТОЛ, то прошивка должна быть не ниже версии 5.15, и установлены дравера 10.10.6 или выше. Обратите внимание, что для компоненты драйверов АТОЛ зафиксирована проблема, что затираются настройки к серверу ОФД и Честному знаку, эти настройки нужно заново указать в параметрах обработки. Эти настройки также можно получить через утилиту тест драйвера ФР ![Настройка ОФД АТОЛ](media/nastroyka_ofd.png) 
   - Для касс Вики принт: внутреннее программное обеспечение ККТ должно быть обновлено до версии 665.4.32.
   - также поддерживаются кассы Меркурий, для них также требуется обновить драйвера.

   
4. Проверить, поддерживает ли ваша конфигурации новые ставки, или при необходимости доработать данный функционал. Вы можете воспользоваться этой [инструкцией](for_programmers.md#изменение-конфигурации-для-поддержки-ндс-5-и-ндс-7), как с минимумом знаний доработать вашу 1С для использования указанных ставок.

5. Для более плавного перехода добавлены 2 параметра обработки: [**"Касса не поддерживает НДС 5% и 7%"** , **"Автоматически перейти на новую ставку в конце года"** ](parameters_description.md#енвд-усн-нефискальные-чеки), о которых можно прочитать по [ссылке](parameters_description.md#енвд-усн-нефискальные-чеки).


## Особенность пробития авансовых чеков и установки признаков способа расчета ##

Пример оформления авансовых чеков представлена на сайте 1С [ИТС](https://its.1c.ru/db/kkt#content:133:hdoc). Механизм работы заполнения программы выполнен по тому же принципу, в частности:

1. Для признаков способа расчета «**Передача с полной оплатой**», «**Передача с частичной оплатой**» и    «**Передача без оплаты**» - сумма чека заполняется вся, однако, если чек оплачивается не полностью, то разница между суммой чека и суммой оплаты ложится на виртуальные оплаты: **Зачет аванса** или **Постоплата**
2. Для переданного признака способа расчета «**Аванс**», строки чека будут заменяться на одну строку с описанием основания и без указания проданного товара, в поле «Признак предмета расчета» будет стоять «Платеж», а количество равно 1, если используется «СтавкаНДС» и Общая Система Налогообложения, то она будет заменена на ставку для авансовых платежей (20/120, 10/110), в остальных случаях будет «БезНДС»
3. Для признака способ расчета «**Предоплата частичная**», заполняется списком товаров, однако в поле количество будет равно 1, в поле признак предмета расчета «Платеж», если используется «СтавкаНДС и Общая Система Налогообложения, то она будет заменена на ставку для авансовых платежей (20/120, 10/110), в остальных случаях будет «БезНДС». Суммы каждой позиции чека будут уменьшена пропорционально сумме оплаты.
4. Для признака способ расчета «**Предоплата полная**», заполняется списком товаров, однако в поле количество будет равно 1, в поле признак предмета расчета «Платеж», если используется «СтавкаНДС», и Общая Система Налогообложения, то она будет заменена на ставку для авансовых платежей (20/120, 10/110), в остальных случаях будет «БезНДС».
5. Для признака способ расчета «**Оплата кредита**», заполняется списком товаров, однако в поле количество будет равно 1, в поле признак предмета расчета «Платеж», «СтавкаНДС» заменена на «БезНДС».

>**Важно:** если используется, например документ «Приходный кассовый ордер» с несколькими документам в расшифровке платежа, то нужно использовать единый Признак способа расчета, иначе программа пока некорректно выполняет разбивку. В будущем такие позиции будут делиться на несколько чеков с учетом
документа сделки.

## Печать копии чека ##

В параметрах обработки можно настроить возможность печати копии чека на обычный принтер. Для этого в параметрах обработки нажмите на **«Настроить печать копий чека»** - откроется форма настройки.

![Печать копии чека](media/85c0535ea9885a4f5c406ff54a59bf68.png)

В поле **«Имя принтера»** необходимо выбрать принтер из списка, и указать количество копий, которые нужно напечатать.

По кнопке **«Проверить компоненту штрихкодов»** - обработка проверяет находится ли в папке с макетами компонента для печати штрихкодов.
> **Важно**: без данной компоненты в копию чека не будет выведен QR код фискального чека.

Для настройка выводимого табличного документа, есть кнопка «Настроить табличный документ», где можно указать как должен выводиться чек.

![Настройка печатной формы](media/a5cf5ca2af0ba83a9200ce5f9df9a701.png)

Копия чека заполняется также, как и фискальный чек, и информацию заполнения можно менять, меняя шаблон документа. Однако часть информации невозможно получить из фискального регистратора, поэтому ее нужно указать вручную. Данные настройки находятся в группе «**Нефискальные чеки**» в параметрах обработки

![Нефискальные чеки](media/e9124ad482e65c03dd60974058f24c64.png)

Если вы хотите, чтобы копия чека выводилась корректно, то данные параметры нужно заполнить.

Копия чека будет напечатана в следующем виде.

![Пример чека 1](media/65d40f967a3c131d111c2bd28ed85b70.jpg)

![Пример чека 2](media/7f277e0724ce8de5c6b3763fe7788931.jpg)

## Редактор произвольного кода ##

Когда в обработке нужно написать код на встроенном языке 1С, открывается редактор произвольного кода. Данный редактор имеет подсветку синтаксиса 1С, можно открыть конструктор запросов, вставить ссылку на объект в базе данных, используются шаблоны кода, используется конструктор форматной строки.

![Редактор произвольного кода](media/5c4b20ad3069e1f0020b8591181922b7.jpg)

## Подключение через прокси ##

![Настройка прокси](media/6dc6c759d35c2fba305e80a530420ac5.png)

Для подключения к прокси необходимо заполнить:

«**Адрес**» - он заполняется в формате «http://адрес:порт», либо «https://адрес:порт», адрес прокси-сервера можно не заполнять, тогда будут использованы настройки по умолчанию.

«**Имя пользователя**» и «**Пароль**» - пользователя, под которым будет происходить подключение к прокси-серверу.

«**Аутентификация операционной системой**» - если установлен данный флажок, то подключение к прокси будет происходить без указания имени пользователя и пароля.

## Форма отладки ##

Для более удобной проверки работы обработки можно использовать «форму отладки», для этого откройте обработку через меню **«Файл»** - **«Открыть»**.

![Меню формы отладки](media/3c1b15272f1a73f0e2a998a1f5128c26.png)

Если конфигурация, в которой была открыта форма отладки не поддерживает работу с торговым оборудованием, то в этом окне можно самостоятельно добавить подключение к новому оборудованию.

![Форма отладки](media/6282ed2ce6a09e2943592547d2006975.png)

Кнопка «Сохранить путь обработки» используется при печати через внешнюю печатную форму, которая идет в комплекте с обработкой. Она сохраняет путь до файла основной обработки в настройки пользователя, затем при печати через внешнюю
печатную форму проверяется указан ли путь до обработки, и если указан, то используется именно обработка по этому пути.

Если же работа с фискальными регистраторами поддерживается, то в данном списке отобразиться уже подключенное оборудование, которой можно перенастроить здесь же.

Из данной формы можно на основании абсолютно любого документа:

1. **Напечатать предварительный чек**, который представляет из себя обычную печатную форму
1. **Напечатать фискальный чек.**

Доступно 2 варианта использование:

- **Предопределенный документ** – это тот документ, для которого алгоритм печати заложен в самой обработке

- **Собственный документ** – для такого документа обработка попробует напечатать чек на основании универсального алгоритма, однако желательно для такого реализовать собственный функционал печати через дополнительный обработчик.

Например, в конфигурации **УТ 10.2**, можно печатать полноценные фискальные чеки без доработки конфигурации.

## Отключение печати бумажного чека ##

Чтобы сократить расход фискальной ленты в обработке можно отключить печать бумажного чека, при этом чек должен быть обязательно отправлен в электронном виде покупателю.
Чек может быть сформирован только электронно в 2-х случаях, либо у вас заключен договор с ОФД на рассылку, тогда перед печатью достаточно указать только email или номер телефона покупателя, и отметить флажок электронно. Либо настроить в параметрах программы рассылку чеков встроенными средствами. Рассмотрим каждый случай.

### Формирование электронного чека средствами ОФД ###

Для такой настройки, в параметрах обработки на закладке "Параметры драйвера" включите флажок **"Передавать чеки в ОФД без печати"**
![Настройка без печати](media/settings_no_print.png) и флажок **"Указывать номер или Email клиента"**. Таким образом перед печатью чека будет предложено ввести данные покупателя и если они будет введены, то чек не напечатается, а будет передан в ОФД и оттуда направлен на указанный адрес клиента.
Данные покупателя можно внести несколькими способами, если включена форма проверки печати, то непосредственно из нее

![Ввод email или номера телефона](media/enter_email.png)
, либо через  специальное окно для ввода
[Форма ввода Email и Номера телефона](management_distribution.md#форма-ввода-email-и-номера-телефона)

Помимо этого программа поддерживает автоматическое заполнение email покупателя по данным 1С, для этого необходимо в том же разделе включить флажок **"Автоматически заполнять email по данным контрагента"**, тогда программа попытается найти email в регистре Контактная информация и установить его перед печатью. Также вы можете снимать признак только электронной печати вручную перед фискализацией, если вдруг потребуется именно бумажная печать.

**Важно**, если не указан email или номер телефона покупателя, то бумажный чек будет напечатан, это ограничение оборудования не позволяющее оставить покупателя без чека, в том или ином виде.

### Формирование электронного чека средствами программы ###

Все настройки аналогичны предыдущему пункту, однако при этом дополнительно необходимо указать и проверить параметры рассылки средствами обработки по этой инструкции [**Рассылка чеков средствами обработки**](management_distribution.md). В таком случае чек будет отправлен именно средствами обработки, но при этом в ОФД все-таки уйдут данные о покупателе, поэтому такой способ рассылки следует использовать только если не заключен договор с ОФД на рассылку.
